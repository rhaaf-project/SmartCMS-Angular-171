<div>
    <div class="panel" style="padding: 15px;">
        <!-- Header -->
        <div class="mb-5 flex flex-col gap-5 md:flex-row md:items-center">
            <h5 class="text-medium font-medium dark:text-white-light">SBC Status Monitor</h5>
            <div class="flex items-center gap-3 ltr:ml-auto rtl:mr-auto">
                <!-- SBC Selector -->
                <select [(ngModel)]="selectedSbcId" (ngModelChange)="onSbcChange()" class="form-select w-auto">
                    <option [ngValue]="null">Select SBC</option>
                    <option *ngFor="let sbc of sbcNodes" [ngValue]="sbc.id">{{ sbc.name }}</option>
                </select>
                <!-- Auto Refresh Toggle -->
                <label class="inline-flex cursor-pointer items-center">
                    <input type="checkbox" [(ngModel)]="autoRefreshEnabled" (ngModelChange)="toggleAutoRefresh()"
                        class="form-checkbox" />
                    <span class="ml-2 text-sm">Auto Refresh</span>
                </label>
                <!-- Manual Refresh Button -->
                <button type="button" class="btn btn-primary btn-sm" (click)="manualRefresh()"
                    [disabled]="isRefreshing || !selectedSbcId">
                    <icon-refresh class="shrink-0" [ngClass]="{'animate-spin': isRefreshing}" />
                    <span class="ml-1">Refresh</span>
                </button>
            </div>
        </div>

        <!-- SBC Info Header -->
        <div *ngIf="selectedSbc" class="mb-5 grid grid-cols-1 gap-4 md:grid-cols-4">
            <div class="panel bg-primary/10 p-4">
                <div class="text-sm text-gray-500 dark:text-gray-400">SBC Name</div>
                <div class="text-lg font-semibold">{{ selectedSbc.name }}</div>
            </div>
            <div class="panel bg-info/10 p-4">
                <div class="text-sm text-gray-500 dark:text-gray-400">IP Address</div>
                <div class="text-lg font-mono">{{ selectedSbc.host }}</div>
            </div>
            <div class="panel bg-warning/10 p-4">
                <div class="text-sm text-gray-500 dark:text-gray-400">Active Channels</div>
                <div class="text-lg font-semibold">{{ liveChannels.length }}</div>
            </div>
            <div class="panel p-4" [ngClass]="selectedSbc.is_active ? 'bg-success/10' : 'bg-danger/10'">
                <div class="text-sm text-gray-500 dark:text-gray-400">Status</div>
                <div class="text-lg font-semibold" [ngClass]="selectedSbc.is_active ? 'text-success' : 'text-danger'">
                    {{ selectedSbc.is_active ? 'Active' : 'Inactive' }}
                </div>
            </div>
        </div>

        <!-- Live Channels Table -->
        <div class="mb-3">
            <h6 class="font-semibold mb-3">Live Channels</h6>
            <div class="table-responsive">
                <table class="table-hover" id="sbc-status-table">
                    <thead>
                        <tr>
                            <th>Channel</th>
                            <th>Source</th>
                            <th>Destination</th>
                            <th>Duration</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngIf="isLoading || isRefreshing">
                            <td colspan="4" class="text-center">
                                <div
                                    class="inline-block h-8 w-8 animate-spin rounded-full border-4 border-primary border-l-transparent">
                                </div>
                            </td>
                        </tr>
                        <tr *ngIf="!isLoading && !isRefreshing && !selectedSbcId">
                            <td colspan="4" class="text-center text-gray-500">Please select an SBC to view live
                                channels</td>
                        </tr>
                        <tr *ngIf="!isLoading && !isRefreshing && selectedSbcId && liveChannels.length === 0">
                            <td colspan="4" class="text-center text-gray-500">No active channels</td>
                        </tr>
                        <tr *ngFor="let ch of liveChannels">
                            <td>
                                <div class="font-mono text-sm">{{ ch.channel }}</div>
                            </td>
                            <td>
                                <span class="font-semibold">{{ ch.source }}</span>
                            </td>
                            <td>
                                <span class="font-semibold">{{ ch.destination }}</span>
                            </td>
                            <td>
                                <span class="font-mono text-sm badge bg-success/20 text-success">{{ ch.duration
                                    }}</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Footer Info -->
        <div class="flex items-center justify-between text-sm text-gray-500">
            <div>{{ liveChannels.length }} active channel(s)</div>
            <div *ngIf="lastRefreshed">
                Last refreshed: {{ lastRefreshed | date:'HH:mm:ss' }}
                <span *ngIf="autoRefreshEnabled" class="ml-2 text-primary">(Auto-refresh: 5s)</span>
            </div>
        </div>
    </div>
</div>